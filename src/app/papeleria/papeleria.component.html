<div class="liba-theme container papeleria-page">
  <h2>Crear nuevo item en catálogo (Papelería)</h2>
  <section>
    <form class="form-grid" (ngSubmit)="crearCatalogo($event)">
      <div>
        <label for="catNombre">Nombre</label>
        <input id="catNombre" [(ngModel)]="catNombre" name="catNombre" required placeholder="Ej: Resmas de papel" />
      </div>
      <div>
        <label for="catItem">Item</label>
        <input id="catItem" type="number" min="1" step="1" [(ngModel)]="catItem" name="catItem" required placeholder="Ej: 2001" />
      </div>
      <div>
        <label for="catImagen">Imagen (opcional)</label>
        <input id="catImagen" type="file" accept="image/*" (change)="onCatImagenChange($event)" />
      </div>
      <div class="full-row">
        <label for="catDescripcion">Descripción</label>
        <textarea id="catDescripcion" [(ngModel)]="catDescripcion" name="catDescripcion" rows="2"></textarea>
      </div>
      <div class="actions"><button class="btn-compact" type="submit">Agregar al catálogo</button></div>
    </form>
  </section>

  <h2>Catálogo de papelería</h2>
  <section>
    <div>
      <div class="filters-grid catalogo-filters">
        <div>
          <label for="catalogoItemQ">Filtrar por item</label>
          <input id="catalogoItemQ" [(ngModel)]="itemFiltro" (input)="filtrarCatalogoPorCampos()" placeholder="Ej: 001" />
        </div>
        <div>
          <label for="catalogoNombreQ">Filtrar por nombre</label>
          <input id="catalogoNombreQ" [(ngModel)]="nombreFiltro" (input)="filtrarCatalogoPorCampos()" placeholder="Ej: Papel" />
        </div>
        <div class="reset-cell">
          <button type="button" class="btn-reset-filtros" (click)="resetCatalogoPaginado()" aria-label="Reiniciar filtros">Reiniciar filtros</button>
        </div>
      </div>

      <div class="cards-container">
        @if (catalogoCargando) {
          <div class="catalogo-cards">
            <article class="catalog-card skeleton-card">
              <div class="catalog-card-media"><div class="skeleton-box"></div></div>
              <div class="card-name"><span class="skeleton-line w-70"></span><span class="skeleton-line w-30"></span></div>
              <div class="card-desc"><div class="skeleton-line w-90"></div></div>
            </article>
            <article class="catalog-card skeleton-card">
              <div class="catalog-card-media"><div class="skeleton-box"></div></div>
              <div class="card-name"><span class="skeleton-line w-70"></span><span class="skeleton-line w-30"></span></div>
              <div class="card-desc"><div class="skeleton-line w-90"></div></div>
            </article>
            <article class="catalog-card skeleton-card">
              <div class="catalog-card-media"><div class="skeleton-box"></div></div>
              <div class="card-name"><span class="skeleton-line w-70"></span><span class="skeleton-line w-30"></span></div>
              <div class="card-desc"><div class="skeleton-line w-90"></div></div>
            </article>
          </div>
        }
        @if (!catalogoCargando && catalogoResultadosSig().length) {
          <div class="catalogo-stats">
            <span>Mostrando {{ catalogoResultadosSig().length }} de {{ catalogoTotal || catalogoBaseSig().length }} elementos</span>
          </div>
        }
        <div class="catalogo-cards">
          @for (c of catalogoResultadosSig(); track c.item) {
            <article class="catalog-card"
                     (click)="onCatalogCardClick(c)" role="button" tabindex="0"
                     (keyup.enter)="onCatalogCardClick(c)" (keyup.space)="onCatalogCardClick(c)">
              <div class="catalog-card-media">
                <img [src]="getCatalogoImagenUrl(c.item)" alt="Imagen {{ c.nombre }}" (error)="onImgError($event)" />
              </div>
              <div class="card-name" [title]="c.nombre">
                <span [innerHTML]="highlightField(c.nombre, 'nombre')"></span>
                <span class="meta">Item: <strong>{{ c.item }}</strong></span>
              </div>
              @if (c.descripcion) {
                <div class="card-desc">{{ c.descripcion }}</div>
              }
            </article>
          }
        </div>
        @if (catalogoResultadosSig().length < (catalogoTotal || 0)) {
          <div class="reset-cell">
            <button type="button" class="btn-load-more" (click)="cargarMasCatalogo()">Cargar más</button>
          </div>
        }
        @if (!catalogoCargando && !catalogoResultadosSig().length) {
          <p>No hay elementos en el catálogo.</p>
        }
      </div>
    </div>
  </section>

  @if (item_catalogo != null) {
    <h2>Crear registro de Papelería</h2>
    <section #papFormSection>
      <form class="form-grid" (ngSubmit)="crearPapeleria($event)">
        <div>
          <label for="item_catalogo">Item catálogo</label>
          <input #itemCatalogoInput id="item_catalogo" [(ngModel)]="item_catalogo" name="item_catalogo" required />
        </div>
        <div>
          <label for="nombre">Nombre</label>
          <input id="nombre" [(ngModel)]="nombre" name="nombre" required />
        </div>
        <div>
          <label for="cantidad_adquirida">Cantidad adquirida</label>
          <input id="cantidad_adquirida" type="number" [(ngModel)]="cantidad_adquirida" name="cantidad_adquirida" required />
        </div>
        <div>
          <label for="cantidad_existente">Cantidad existente</label>
          <input id="cantidad_existente" type="number" [(ngModel)]="cantidad_existente" name="cantidad_existente" required />
        </div>
        <div>
          <label for="presentacion">Presentación</label>
          <select id="presentacion" [(ngModel)]="presentacion" name="presentacion">
            <option value="">Seleccione</option>
            <option value="unidad">Unidad</option>
            <option value="paquete">Paquete</option>
            <option value="caja">Caja</option>
            <option value="cajas">Cajas</option>
          </select>
        </div>
        <div>
          <label for="marca">Marca</label>
          <input id="marca" [(ngModel)]="marca" name="marca" />
        </div>
        <div>
          <label for="ubicacion">Ubicación</label>
          <input id="ubicacion" [(ngModel)]="ubicacion" name="ubicacion" />
        </div>
        <div>
          <label for="fecha_adquisicion">Fecha de adquisición</label>
          <input id="fecha_adquisicion" type="date" [(ngModel)]="fecha_adquisicion" name="fecha_adquisicion" />
        </div>
        <div class="full-row">
          <label for="descripcion">Descripción</label>
          <textarea id="descripcion" [(ngModel)]="descripcion" name="descripcion" rows="2"></textarea>
        </div>
        <div class="full-row">
          <label for="observaciones">Observaciones</label>
          <textarea id="observaciones" [(ngModel)]="observaciones" name="observaciones" rows="2"></textarea>
        </div>
        <div class="actions">
          <button class="btn-compact" type="submit">Crear</button>
        </div>
      </form>
    </section>
  }

  
</div>
