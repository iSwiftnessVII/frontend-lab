<div class="liba-theme container equipos-page">
	<h2>Registrar equipo</h2>
	<section>
		<form class="form-grid" (submit)="crearEquipo($event)">
			<div>
				<label for="nombre">Nombre *</label>
				<input id="nombre" name="nombre" [(ngModel)]="nombre" required placeholder="Ej: Balanza analítica" />
			</div>
			<div>
				<label for="modelo">Modelo</label>
				<input id="modelo" name="modelo" [(ngModel)]="modelo" />
			</div>
			<div>
				<label for="marca">Marca</label>
				<input id="marca" name="marca" [(ngModel)]="marca" />
			</div>
			<div>
				<label for="inventario_sena">Inventario SENA</label>
				<input id="inventario_sena" name="inventario_sena" [(ngModel)]="inventario_sena" />
			</div>

			<div>
				<label for="acreditacion">Acreditación</label>
				<select id="acreditacion" name="acreditacion" [(ngModel)]="acreditacion">
					<option [ngValue]="''">Seleccione</option>
					<option [ngValue]="'Si'">Si</option>
					<option [ngValue]="'No aplica'">No aplica</option>
				</select>
			</div>
			<div>
				<label for="tipo_manual">Tipo de manual</label>
				<select id="tipo_manual" name="tipo_manual" [(ngModel)]="tipo_manual">
					<option [ngValue]="''">Seleccione</option>
					<option [ngValue]="'Fisico'">Físico</option>
					<option [ngValue]="'Digital'">Digital</option>
				</select>
			</div>
			<div>
				<label for="manual_usuario">Manual de usuario</label>
				<select id="manual_usuario" name="manual_usuario" [(ngModel)]="manual_usuario">
					<option [ngValue]="''">Seleccione</option>
					<option [ngValue]="'Si'">Si</option>
					<option [ngValue]="'No'">No</option>
				</select>
			</div>

			<div>
				<label for="codigo_identificacion">Código de identificación</label>
				<input id="codigo_identificacion" name="codigo_identificacion" [(ngModel)]="codigo_identificacion" />
			</div>
			<div>
				<label for="numero_serie">Número de serie</label>
				<input id="numero_serie" name="numero_serie" [(ngModel)]="numero_serie" />
			</div>
			<div>
				<label for="tipo">Tipo</label>
				<input id="tipo" name="tipo" [(ngModel)]="tipo" />
			</div>
			<div>
				<label for="clasificacion">Clasificación</label>
				<input id="clasificacion" name="clasificacion" [(ngModel)]="clasificacion" />
			</div>

			<div>
				<label for="puesta_en_servicio">Puesta en servicio</label>
				<input id="puesta_en_servicio" type="date" name="puesta_en_servicio" [(ngModel)]="puesta_en_servicio" />
			</div>
			<div class="stack-field">
				<label for="fecha_adquisicion">Fecha de adquisición</label>
				<input id="fecha_adquisicion" type="date" name="fecha_adquisicion" [(ngModel)]="fecha_adquisicion" />
				<div class="actions">
					<button class="btn-compact" type="submit" [disabled]="creando">{{ creando ? 'Guardando…' : 'Crear equipo' }}</button>
				</div>
			</div>
		</form>
	</section>

	<h2>Listado de equipos</h2>
	<section>
		<div class="cards-container">
			<div class="filters-grid">
				<div>
					<label for="eqQ">Buscar</label>
					<input id="eqQ" [(ngModel)]="q" (input)="filtrar()" placeholder="Nombre, marca o código" />
				</div>
			</div>

			@if (cargando) { <p>Cargando...</p> }
				@if (!cargando && listaFiltrada.length) {
					<div class="catalogo-stats">
						<span>Mostrando {{ listaFiltrada.length }} de {{ lista.length }} equipos</span>
					</div>
					<div class="lane-list">
						@for (e of listaFiltrada; track trackById($index, e)) {
						<article class="equip-lane" (click)="toggleFila(e)" [attr.aria-expanded]="isFilaExpandida(e)" tabindex="0">
							<div class="lane-header">
								<div class="chips">
									@if (e.codigo_identificacion) { <span class="pill"><strong>Código:</strong> {{ e.codigo_identificacion }}</span> }
									@if (e.marca) { <span class="pill"><strong>Marca:</strong> {{ e.marca }}</span> }
									@if (e.modelo) { <span class="pill"><strong>Modelo:</strong> {{ e.modelo }}</span> }
									@if (e.numero_serie) { <span class="pill"><strong>Serie:</strong> {{ e.numero_serie }}</span> }
									@if (e.tipo) { <span class="pill"><strong>Tipo:</strong> {{ e.tipo }}</span> }
									@if (e.clasificacion) { <span class="pill"><strong>Clasificación:</strong> {{ e.clasificacion }}</span> }
								</div>
								<button type="button" class="icon-btn danger" title="Eliminar" aria-label="Eliminar" (click)="$event.stopPropagation()">
									<svg viewBox="0 0 24 24" class="icon" aria-hidden="true">
										<path d="M6 6l12 12M6 18L18 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
									</svg>
								</button>
							</div>
							<div class="lane-title" [title]="e.nombre">{{ e.nombre }}</div>
							@if (isFilaExpandida(e)) {
							<div class="lane-details" (click)="$event.stopPropagation()">
								<div class="details-grid">
									<div class="detail-card"><div class="detail-label">Inventario SENA</div><div class="detail-value">{{ e.inventario_sena || '—' }}</div></div>
									<div class="detail-card"><div class="detail-label">Acreditación</div><div class="detail-value">{{ e.acreditacion || '—' }}</div></div>
									<div class="detail-card"><div class="detail-label">Manual usuario</div><div class="detail-value">{{ e.manual_usuario || '—' }}</div></div>
									<div class="detail-card"><div class="detail-label">Tipo manual</div><div class="detail-value">{{ e.tipo_manual || '—' }}</div></div>
									<div class="detail-card"><div class="detail-label">Puesta en servicio</div><div class="detail-value">{{ formatFechaPuesta(e.puesta_en_servicio) }}</div></div>
									<div class="detail-card"><div class="detail-label">Adquisición</div><div class="detail-value">{{ e.fecha_adquisicion ? (e.fecha_adquisicion | date:'yyyy-MM-dd') : '—' }}</div></div>
								</div>
							</div>
							}
						</article>
						}
					</div>
				}
			@if (!cargando && !listaFiltrada.length) { <p>No hay equipos que coincidan con la búsqueda.</p> }
			@if (!cargando && !lista.length) { <p>No hay equipos registrados.</p> }
		</div>
	</section>
</div>

