<!-- ====== HEADER GLOBAL LIBA ====== -->
<header id="app-header" class="header" *ngIf="user() || isAuthInitializing()">
  <div class="header-content">
    <div class="logo-section">
      <div class="logo">LIBA</div>
      <div>
        <div class="header-title">
          Laboratorio Integrado de Biociencias Aplicadas
        </div>
        <div class="header-subtitle">
          Sistema de Gestión de Inventarios ISO 17025
        </div>
      </div>
    </div>

    <div class="user-menu">
      <!-- User initial circle -->
      <button type="button" class="user-initial" [class.active]="menuOpen()" aria-haspopup="true" [attr.aria-expanded]="menuOpen()" (click)="toggleUserMenu()">
        {{ (user()?.email || '')[0] | uppercase }}
      </button>

  <!-- Dropdown menu (present but toggled via .open for animation) -->
  <div class="user-dropdown gh-style" [class.open]="menuOpen()" [attr.aria-hidden]="!menuOpen()" role="menu">
        <!-- Profile header: larger area showing name and email -->
        <div class="profile-header">
          <div class="profile-initial">{{ (user()?.email || '')[0] | uppercase }}</div>
          <div class="profile-meta">
            <div class="profile-name">{{ userShortName() }}</div>
            <div class="profile-email">{{ user()?.email }}</div>
          </div>
        </div>

        <div class="profile-actions">
          <button type="button" class="user-dropdown-item" role="menuitem">
            <i class="fas fa-user" aria-hidden="true"></i>
            <span>Perfil</span>
          </button>
          <button type="button" class="user-dropdown-item" role="menuitem">
            <i class="fas fa-cog" aria-hidden="true"></i>
            <span>Opciones</span>
          </button>
        </div>

        <hr class="dropdown-divider"/>
        <button type="button" class="user-dropdown-item logout" (click)="onLogout()" [disabled]="isLoggingOut()" role="menuitem">
          <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
          <span>{{ isLoggingOut() ? 'Cerrando sesión…' : 'Salir' }}</span>
        </button>
  </div>
    </div>
  </div>
</header>

<!-- ====== NAVIGATION MENU ====== -->
<nav class="nav-menu" *ngIf="user() || isAuthInitializing()">
  <div class="nav-content">
    <a
      routerLink="/dashboard"
      routerLinkActive="active"
      [routerLinkActiveOptions]="{ exact: true }"
      class="nav-item"
    >
      <i class="fas fa-tachometer-alt"></i> Dashboard
    </a>

    <a routerLink="/solicitudes" routerLinkActive="active" class="nav-item">
      <i class="fas fa-clipboard-list"></i> Solicitudes
    </a>

    <a routerLink="/reactivos" routerLinkActive="active" class="nav-item">
      <i class="fas fa-flask"></i> Reactivos
    </a>

    <a routerLink="/insumos" routerLinkActive="active" class="nav-item">
      <i class="fas fa-boxes"></i> Insumos
    </a>

    <a routerLink="/usuarios" routerLinkActive="active" class="nav-item">
      <i class="fas fa-users"></i> Usuarios
    </a>
  </div>
</nav>

<!-- ====== CONTENIDO PRINCIPAL ====== -->
<main class="main-content liba-theme">
  <router-outlet></router-outlet>

  <!-- Auth initialization overlay -->
  <div class="auth-loading-overlay" *ngIf="isAuthInitializing()">
    <div class="auth-spinner">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
    <div class="auth-loading-text">Validando sesión…</div>
  </div>
</main>

<!-- ====== FOOTER GLOBAL LIBA ====== -->
<footer class="app-footer" *ngIf="showFooter()">
  <p>
    © {{ currentYear }} LIBA - Laboratorio Integrado de Biociencias Aplicadas.
    Todos los derechos reservados.
  </p>
</footer>
