<!-- ====== HEADER GLOBAL LIBA ====== -->
<header id="app-header" class="header" *ngIf="user()">
  <div class="header-content">
    <div class="logo-section">
      <div class="logo">LIBA</div>
      <div>
        <div class="header-title">
          Laboratorio Integrado de Biociencias Aplicadas
        </div>
        <div class="header-subtitle">
          Sistema de Gestión de Inventarios ISO 17025
        </div>
      </div>
    </div>

    <div class="user-menu">
      <!-- User initial circle -->
      <button type="button" class="user-initial" [class.active]="menuOpen()" aria-haspopup="true" [attr.aria-expanded]="menuOpen()" (click)="toggleUserMenu()">
        {{ (user()?.email || '')[0] | uppercase }}
      </button>

      <!-- Dropdown menu -->
      <div class="user-dropdown gh-style" [class.open]="menuOpen()" [attr.aria-hidden]="!menuOpen()" role="menu">
        <!-- Profile header: larger area showing name and email -->
        <div class="profile-header">
          <div class="profile-initial">{{ (user()?.email || '')[0] | uppercase }}</div>
          <div class="profile-meta">
            <div class="profile-name">{{ userShortName() }}</div>
            <div class="profile-email">{{ user()?.email }}</div>
            <div class="profile-role">{{ user()?.rol }}</div>
          </div>
        </div>

        <div class="profile-actions">
          <button type="button" class="user-dropdown-item" role="menuitem">
            <i class="fas fa-user" aria-hidden="true"></i>
            <span>Perfil</span>
          </button>
          <button type="button" class="user-dropdown-item" role="menuitem">
            <i class="fas fa-cog" aria-hidden="true"></i>
            <span>Opciones</span>
          </button>
        </div>

        <hr class="dropdown-divider"/>
        <button type="button" class="user-dropdown-item logout" (click)="onLogout()" [disabled]="isLoggingOut()" role="menuitem">
          <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
          <span>{{ isLoggingOut() ? 'Cerrando sesión…' : 'Salir' }}</span>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- ====== NAVIGATION MENU ====== -->
<nav class="nav-menu" *ngIf="user()">
  <div class="nav-content">
    <!-- Mostrar estas páginas solo si NO es Superadmin -->
    <a
      *ngIf="user()?.rol !== 'Superadmin'"
      routerLink="/dashboard"
      routerLinkActive="active"
      [routerLinkActiveOptions]="{ exact: true }"
      class="nav-item"
    >
      <i class="fas fa-tachometer-alt"></i> Dashboard
    </a>

    <a 
      *ngIf="user()?.rol !== 'Superadmin'" 
      routerLink="/solicitudes" 
      routerLinkActive="active" 
      class="nav-item"
    >
      <i class="fas fa-clipboard-list"></i> Solicitudes
    </a>

    <!-- Inventario dropdown: hover OR click to open -->
    <div 
      *ngIf="user()?.rol !== 'Superadmin'" 
      class="nav-item dropdown"
    >
      <button
        type="button"
        class="dropdown-toggle"
        aria-haspopup="true"
        aria-expanded="false"
      >
        <i class="fas fa-warehouse" aria-hidden="true"></i>
        <span>Inventario</span>
        <i class="fas fa-chevron-down caret" aria-hidden="true"></i>
      </button>

      <div class="dropdown-menu" role="menu">
        <a routerLink="/reactivos" class="dropdown-item" role="menuitem">
          <i class="fas fa-flask" aria-hidden="true"></i>
          <span>Reactivos</span>
        </a>
        <a routerLink="/insumos" class="dropdown-item" role="menuitem">
          <i class="fas fa-boxes" aria-hidden="true"></i>
          <span>Insumos</span>
        </a>
        <button type="button" class="dropdown-item disabled" role="menuitem" disabled>
          <i class="fas fa-paperclip" aria-hidden="true"></i>
          <span>Papelería</span>
        </button>
        <button type="button" class="dropdown-item disabled" role="menuitem" disabled>
          <i class="fas fa-vials" aria-hidden="true"></i>
          <span>Materiales volumétricos</span>
        </button>
      </div>
    </div>

    <!-- Mostrar Usuarios solo si ES Superadmin -->
    <a 
      *ngIf="user()?.rol === 'Superadmin'" 
      routerLink="/usuarios" 
      routerLinkActive="active" 
      class="nav-item"
    >
      <i class="fas fa-users"></i> Usuarios
    </a>
  </div>
</nav>

<!-- ====== CONTENIDO PRINCIPAL ====== -->
<main class="main-content liba-theme">
  <router-outlet></router-outlet>
</main>

<!-- ====== FOOTER GLOBAL LIBA ====== -->
<footer class="app-footer" *ngIf="showFooter()">
  <p>
    © {{ currentYear }} LIBA - Laboratorio Integrado de Biociencias Aplicadas.
    Todos los derechos reservados.
  </p>
</footer>